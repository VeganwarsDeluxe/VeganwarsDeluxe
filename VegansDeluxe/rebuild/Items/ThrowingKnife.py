import random

from VegansDeluxe.core import AttachedAction, RegisterItem
from VegansDeluxe.core import Item
from VegansDeluxe.core import DecisiveItem
from VegansDeluxe.core import Enemies


@RegisterItem
class ThrowingKnife(Item):
    id = 'throwing_knife'
    name = '–ú–µ—Ç–∞—Ç–µ–ª—å–Ω—ã–π –Ω–æ–∂'


@AttachedAction(ThrowingKnife)
class ThrowingKnifeAction(DecisiveItem):
    id = 'throwing_knife'
    target_type = Enemies()

    @property
    def name(self):
        return f'–ú–µ—Ç–∞—Ç–µ–ª—å–Ω—ã–π –Ω–æ–∂ ({self.hit_chance}%)'

    @property
    def hit_chance(self):
        return 40 + self.source.energy * 10

    def func(self, source, target):
        source.energy -= 1
        if random.randint(0, 100) > self.hit_chance:
            self.session.say(f"üí®|{source.name} –∫–∏–¥–∞–µ—Ç –º–µ—Ç–∞—Ç–µ–ª—å–Ω—ã–π –Ω–æ–∂ –≤ {target.name}, –Ω–æ –Ω–µ –ø–æ–ø–∞–¥–∞–µ—Ç.")
            return
        bleeding = target.get_state('bleeding')
        if bleeding.active:
            bleeding.bleeding -= 1
        bleeding.active = True
        self.session.say(f'üî™|{source.name} –∫–∏–¥–∞–µ—Ç –º–µ—Ç–∞—Ç–µ–ª—å–Ω—ã–π –Ω–æ–∂ –≤ {target.name}.\n'
                         f'‚ù£Ô∏è|{target.name} –∏—Å—Ç–µ–∫–∞–µ—Ç –∫—Ä–æ–≤—å—é!')
